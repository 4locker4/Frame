Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 1
regs.asm



      1				     ;------------------------------------------------------------------------------
      2				     ;				 Register watcher
      3				     ;------------------------------------------------------------------------------
      4
      5	0000			     .model tiny
      6	0000			     .data
      7
      8				     ;------------------------------------------------------------------------------
      9				     ;					     CONSTANTS
     10				     ;------------------------------------------------------------------------------
     11
     12	      =B800		     VIDEO_MEM		     equ 0b800h
     13	      =00A0		     SCREEN_LENGHT_IN_MEM    equ 160
     14	      =000A		     LENGHT_OF_FRAME_MASSIVE equ 10
     15	      =000B		     CENTER_OF_SCREEN_CLMN   equ 11
     16	      =0019		     SCREEN_HIGHT_IN_VISUAL  equ 25
     17
     18	      =003C		     FRAME_COLOR	     equ 3ch
     19	      =0014		     FRAME_HIGHT	     equ 20
     20	      =001E		     FRAME_LENGHT	     equ 30
     21
     22	      =0066		     FRAME_ACTIVATOR	     equ 'f'
     23	      =0071		     STOP_FRAME		     equ 'q'
     24
     25	0000			     .code
     26
     27				     org 100h
     28
     29				     PUSH_TO_SAVE_ALL_REGS   macro
     30							     push es ds	sp bp si di dx cx bx ax
     31
     32							     endm
     33
     34				     POP_SAVED_REGS	     macro
     35							     pop ax bx cx dx di	si bp sp ds es
     36
     37							     endm
     38
     39
     40	0100			     Start:
     41	0100  E8 016D				     call OutputRegs
     42
     43	0103  B4 4C				     mov ah, 4ch
     44	0105  CD 21				     int 21h
     45
     46	0107  E8 0011				     call StartResidentProgramm
     47
     48	010A  B8 3100				     mov ax, 3100h
     49	010D  BA 0306r				     mov dx, offset EOP
     50	0110  D1 EA D1 EA D1 EA	D1+		     shr dx, 4
     51	      EA
     52	0118  42				     inc dx
     53
     54	0119  CD 21				     int 21h
     55
     56				     ;-------------------------------------------------------------------------------
     57				     ;
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 2
regs.asm



     58				     ;
     59				     ;
     60				     ;
     61				     ;
     62				     ;
     63				     ;-------------------------------------------------------------------------------
     64
     65	011B			     StartResidentProgramm proc
     66
     67				     ;---------------Interrapt 09h---------------------------------------------------
     68	011B  B8 3509				     mov ax, 3509h
     69	011E  CD 21				     int 21h
     70
     71	0120  89 1E 0246r			     mov Int09Ofs, bx
     72	0124  8C C3				     mov bx, es
     73	0126  89 1E 0248r			     mov Int09Seg, bx
     74
     75	012A  50 55 8B EC C7 46	02+		     push 0
     76	      0000 5D
     77	0134  07				     pop es
     78
     79	0135  BB 0024				     mov bx, 09h * 4
     80
     81	0138  0E				     push cs
     82	0139  58				     pop ax
     83
     84	013A  FA				     cli
     85	013B  26: C7 07	0181r			     mov es: [bx], offset FrameMaker
     86	0140  26: 89 47	02			     mov es: [bx+2], ax
     87	0144  FB				     sti
     88
     89				     ;---------------Interrapt 08h---------------------------------------------------
     90	0145  B8 3508				     mov ax, 3508h
     91	0148  CD 21				     int 21h
     92
     93	014A  89 1E 026Cr			     mov Int08Ofs, bx
     94	014E  8C C3				     mov bx, es
     95	0150  89 1E 026Er			     mov Int08Seg, bx
     96
     97	0154  50 55 8B EC C7 46	02+		     push 0
     98	      0000 5D
     99	015E  07				     pop es
    100
    101	015F  BB 0020				     mov bx, 08h * 4
    102
    103	0162  0E				     push cs
    104	0163  58				     pop ax
    105
    106	0164  FA				     cli
    107	0165  26: C7 07	024Ar			     mov es: [bx], offset Int08StatusScanner
    108	016A  26: 89 47	02			     mov es: [bx+2], ax
    109	016E  FB				     sti
    110
    111				     ;---------------End programm resident-------------------------------------------
    112	016F  B8 3100				     mov ax, 3100h
    113	0172  BA 0306r				     mov dx, offset EOP
    114	0175  D1 EA D1 EA D1 EA	D1+		     shr dx, 4
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 3
regs.asm



    115	      EA
    116	017D  42				     inc dx
    117	017E  CD 21				     int 21h
    118
    119	0180  C3				     ret
    120	0181					     endp
    121
    122				     ;-------------------------------------------------------------------------------
    123				     ;							     FRAME MAKER
    124				     ;Entry:	     BH	- hight
    125				     ;		     BL	- lenght
    126				     ;		     DH	- frame	color
    127				     ;		     SI	- addres of frame chars
    128				     ;Retrn:	     none
    129				     ;Destr:	     AX, BX, CX, DX, ES, SI, DI
    130				     ;-------------------------------------------------------------------------------
    131
    132	0181			     FrameMaker	     proc
    133
    134						     PUSH_TO_SAVE_ALL_REGS
1   135	0181  06 1E 54 55 56 57	52+			     push es ds	sp bp si di dx cx bx ax
    136	      51 53 50
1   137
    138
    139	018B  B7 14				     mov bh, FRAME_HIGHT
    140	018D  B3 1E				     mov bl, FRAME_LENGHT
    141	018F  B6 3C				     mov dh, FRAME_COLOR
    142	0191  BE 02D2r				     lea si, FrameMassive
    143
    144	0194  E8 0049				     call TakeFrameCoordinate			     ; DI - coords
    145
    146	0197  50 55 8B EC C7 46	02+		     push VIDEO_MEM
    147	      B800 5D
    148	01A1  07				     pop es
    149
    150	01A2  33 C0				     xor ax, ax
    151	01A4  8A E6				     mov ah, dh
    152
    153	01A6  57				     push di
    154
    155	01A7  8A CB				     mov cl, bl
    156
    157	01A9  E8 002C				     call DrawOneLine				     ; DrawLine
    158
    159	01AC  5F				     pop di
    160	01AD  81 C7 00A0			     add di, SCREEN_LENGHT_IN_MEM
    161
    162	01B1  8A CF				     mov cl, bh
    163
    164				     ;		     ----------------------------------------
    165	01B3				     StartDrawing:
    166	01B3  57				     push di
    167	01B4  51				     push cx
    168
    169	01B5  8A CB				     mov cl, bl
    170
    171	01B7  E8 001E				     call DrawOneLine
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 4
regs.asm



    172
    173	01BA  59				     pop cx
    174	01BB  83 EE 03				     sub si, 3
    175	01BE  5F				     pop di
    176	01BF  81 C7 00A0			     add di, SCREEN_LENGHT_IN_MEM
    177
    178	01C3  E2 EE				     loop StartDrawing
    179				     ;		     ----------------------------------------
    180
    181	01C5  83 C6 03				     add si, 3
    182	01C8  8A CB				     mov cl, bl
    183
    184	01CA  E8 000B				     call DrawOneLine
    185
    186						     POP_SAVED_REGS
1   187	01CD  58 5B 59 5A 5F 5E	5D+			     pop ax bx cx dx di	si bp sp ds es
    188	      5C 1F 07
1   189
    190
    191	01D7  C3				     ret
    192	01D8					     endp
    193
    194				     ;------------------------------------------------------------------------------
    195				     ;							     DRAW ONE LINE
    196				     ;NOTE!  ES	must be	b800!
    197				     ;
    198				     ;Entry:
    199				     ;		     CX	- lenght of frame
    200				     ;		     AH	- color	of frame
    201				     ;		     SI	- addres of char massive
    202				     ;		     DI	- coordinates
    203				     ;
    204				     ;Retrn:	     none
    205				     ;Destr:	     CX, SI, DI
    206				     ;------------------------------------------------------------------------------
    207	01D8			     DrawOneLine     proc
    208
    209	01D8  AC				     lodsb						     ; add first symbol
    210	01D9  AB				     stosw						     ; move into graphic mem
    211
    212	01DA  AC				     lodsb						     ; take new	symbol
    213
    214	01DB  F3> AB				     rep stosw						     ; mul them	into graphic+
    215				     mem
    216
    217	01DD  AC				     lodsb						     ; add last	symbol
    218	01DE  AB				     stosw						     ; move into graphic mem
    219
    220	01DF  C3				     ret
    221	01E0					     endp
    222				     ;------------------------------------------------------------------------------
    223
    224				     ;------------------------------------------------------------------------------
    225				     ;							     TAKE COORDINATES
    226				     ;Entry:	     BL	- lenght of frame
    227				     ;		     BH	- hight	of frame
    228				     ;Retrn:	     DI	- coordinate
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 5
regs.asm



    229				     ;Destr:	     AX, BX, CX, DI
    230				     ;
    231				     ;------------------------------------------------------------------------------
    232	01E0			     TakeFrameCoordinate     proc
    233
    234	01E0  B8 0019				     mov ax, SCREEN_HIGHT_IN_VISUAL
    235	01E3  2A C7				     sub al, bh
    236	01E5  2D 0002				     sub ax, 2
    237	01E8  D1 E8				     shr ax, 1
    238	01EA  8B C8				     mov cx, ax
    239	01EC  D1 E0 D1 E0 D1 E0	D1+		     shl ax, 5
    240	      E0 D1 E0
    241	01F6  D1 E1 D1 E1 D1 E1			     shl cx, 3
    242	01FC  03 C1				     add ax, cx
    243	01FE  D1 E0 D1 E0			     shl ax, 2
    244
    245	0202  B9 0050				     mov cx, SCREEN_LENGHT_IN_MEM / 2
    246	0205  2A CB				     sub cl, bl
    247	0207  D1 E9				     shr cx, 1
    248	0209  D1 E1				     shl cx, 1
    249
    250	020B  03 C1				     add ax, cx
    251
    252	020D  2D 0002				     sub ax, 2
    253
    254	0210  8B F8				     mov di, ax
    255
    256	0212  C3				     ret
    257	0213					     endp
    258				     ;-----------------------------------------------------------------------------
    259
    260				     ;-----------------------------------------------------------------------------
    261				     ;				 WITH OR NOT WITH FRAME
    262				     ;Entry:
    263				     ;Retrn:
    264				     ;Destr:
    265				     ;
    266				     ;-----------------------------------------------------------------------------
    267	0213			     WithOrNotWithFrame	     proc
    268
    269	0213  50				     push ax
    270
    271	0214  E4 60				     in	al, 60h
    272
    273	0216  3C 66				     cmp al, FRAME_ACTIVATOR
    274	0218  75 0E				     jne NotActivateSymb
    275
    276	021A  58				     pop ax
    277
    278	021B  E8 FF63				     call FrameMaker
    279
    280	021E  50				     push ax
    281
    282	021F  C6 06 0305r 01 90			     mov ActivateFrame,	1
    283	0225  EB 0B 90				     jmp ActivateKeyboard
    284
    285	0228				     NotActivateSymb:
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 6
regs.asm



    286
    287	0228  3C 71				     cmp al, STOP_FRAME
    288	022A  75 18				     jne NotSpecialSymb
    289
    290	022C  C6 06 0305r 00 90			     mov ActivateFrame,	0
    291
    292	0232				     ActivateKeyboard:
    293	0232  E4 61				     in	al, 61h				     ; закидываем в al то,	    +
    294				     что лежит в порте 61h
    295	0234  8A E0				     mov ah, al				     ; сохраняем
    296	0236  0C 80				     or	al, 80h				     ; разрешаем		    +
    297				     клавиатуру
    298	0238  E6 61				     out 61h, al
    299	023A  86 C4				     xchg al, ah
    300	023C  E6 61				     out 61h, al			     ; выводим значение в   +
    301				     порт
    302
    303	023E  B0 20				     mov al, 20h			     ; Конец прерывания
    304	0240  E6 20				     out 20h, al
    305
    306	0242  58				     pop ax
    307
    308	0243  CF				     iret
    309
    310	0244				     NotSpecialSymb:
    311
    312	0244  58				     pop ax
    313
    314	0245  EA				     db	0eah
    315
    316	0246  0000				     Int09Ofs	 dw 0
    317	0248  0000				     Int09Seg	 dw 0
    318
    319	024A					     endp
    320
    321				     ;-----------------------------------------------------------------------------
    322				     ;				 INT 08	STATUS SCANER
    323				     ;Enrty:
    324				     ;Retrn:
    325				     ;Destr:
    326				     ;
    327				     ;-----------------------------------------------------------------------------
    328	024A			     Int08StatusScanner	     proc
    329
    330	024A  E8 FFC6				     call WithOrNotWithFrame
    331
    332	024D  80 3E 0305r 01			     cmp ActivateFrame,	1
    333	0252  75 17				     jne NothingToDraw
    334
    335						     PUSH_TO_SAVE_ALL_REGS
1   336	0254  06 1E 54 55 56 57	52+			     push es ds	sp bp si di dx cx bx ax
    337	      51 53 50
1   338
    339
    340	025E  E8 000F				     Call OutputRegs
    341
    342						     POP_SAVED_REGS
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 7
regs.asm



1   343	0261  58 5B 59 5A 5F 5E	5D+			     pop ax bx cx dx di	si bp sp ds es
    344	      5C 1F 07
1   345
    346
    347	026B				     NothingToDraw:
    348
    349	026B  EA				     db	0eah
    350
    351	026C  0000				     Int08Ofs dw 0
    352	026E  0000				     Int08Seg dw 0
    353
    354	0270					     endp
    355
    356				     ;-----------------------------------------------------------------------------
    357				     ;				 OUTPUT	REGS
    358				     ;Entry:	     none
    359				     ;Retrn:	     none
    360				     ;Destr:	     none
    361				     ;
    362				     ;-----------------------------------------------------------------------------
    363	0270			     OutputRegs	     proc
    364
    365						     PUSH_TO_SAVE_ALL_REGS
1   366	0270  06 1E 54 55 56 57	52+			     push es ds	sp bp si di dx cx bx ax
    367	      51 53 50
1   368
    369	027A  0E				     push cs
    370
    371	027B  50 55 8B EC C7 46	02+		     push VIDEO_MEM
    372	      B800 5D
    373	0285  07				     pop es
    374
    375	0286  B4 4E				     mov ah, 4eh
    376	0288  BF 02C9				     mov di, 80	* 4 * 2	+ 80 - 8 + 1
    377
    378
    379	028B  C3				     ret
    380
    381	028C					     endp
    382
    383				     ;-----------------------------------------------------------------------------
    384
    385				     ;-----------------------------------------------------------------------------
    386
    387
    388				     ;-----------------------------------------------------------------------------
    389				     ;				 WRITE REGISTER
    390				     ;
    391				     ;	     Warning! ES must be in 0b800h!
    392				     ;
    393				     ;Entry:	 FIRST_REG_LETTER    - first register`s	letter
    394				     ;		 SECOND_REG_LETTER   - second register`s letter
    395				     ;		 AH		     - color of	the text
    396				     ;		 DX		     - register`s data
    397				     ;		 DI		     - address in video	segment
    398				     ;Retrn:	 DI - address in video segment
    399				     ;Destr:	 AL
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 8
regs.asm



    400				     ;
    401				     ;-----------------------------------------------------------------------------
    402	028C			     WriteRegister   proc
    403
    404	028C  33 C9				     xor cx, cx
    405
    406	028E  A0 02DBr				     mov al, FIRST_REG_LETTER
    407	0291  AB				     stosw
    408
    409	0292  A0 02DCr				     mov al, SECOND_REG_LETTER
    410	0295  AB				     stosw
    411
    412	0296  B0 3A				     mov al, ':'
    413	0298  AB				     stosw
    414
    415	0299  B0 20				     mov al, ' '
    416	029B  AB				     stosw
    417
    418	029C  8A CA				     mov cl, dl
    419	029E  80 E1 0F				     and cl, 0Fh
    420	02A1  E8 0024				     call AntiAtoi
    421
    422	02A4  8A CA				     mov cl, dl
    423	02A6  D0 E9 D0 E9 D0 E9	D0+		     shr cl, 4
    424	      E9
    425	02AE  E8 0017				     call AntiAtoi
    426
    427	02B1  8A CE				     mov cl, dh
    428	02B3  E8 0012				     call AntiAtoi
    429
    430	02B6  8A CE				     mov cl, dh
    431	02B8  D0 E9 D0 E9 D0 E9	D0+		     shr cl, 4
    432	      E9
    433	02C0  E8 0005				     call AntiAtoi
    434
    435	02C3  81 C7 0090			     add di, 160 - 8 * 2
    436
    437	02C7  C3				     ret
    438	02C8					     endp
    439
    440				     ;-----------------------------------------------------------------------------
    441
    442				     ;-----------------------------------------------------------------------------
    443				     ;							     ANTI ATOI
    444				     ;Entry:	 CX - number to	output
    445				     ;		 DI - address in videoseg
    446				     ;Retrn:	 AL - converted	number
    447				     ;Destr:	 AL, BX, CX
    448				     ;
    449				     ;-----------------------------------------------------------------------------
    450
    451	02C8			     AntiAtoi	 proc
    452
    453	02C8  BB 02DDr				     mov bx, offset HEX_SYMBOLS
    454
    455	02CB  03 D9				     add bx, cx
    456	02CD  2E: 8A 07				     mov al, cs:[bx]
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 9
regs.asm



    457
    458	02D0  AB				     stosw
    459
    460	02D1  C3				     ret
    461	02D2					     endp
    462				     ;-----------------------------------------------------------------------------
    463
    464				     ;FrameMassive	 db 0c9h, 0cbh,	0bbh, 0cch, ' ', 0b9h, 0c8h, 0cah, 0bch
    465	02D2  31 32 33 34 20 36	37+  FrameMassive	 db '1234 6789'
    466	      38 39
    467
    468	02DB  00		     FIRST_REG_LETTER	 db 0
    469	02DC  00		     SECOND_REG_LETTER	 db 0
    470
    471	02DD  30 31 32 33 34 35	36+  HEX_SYMBOLS	 db '0123456789ABCDEF'
    472	      37 38 39 41 42 43	44+
    473	      45 46
    474	02ED  41 58 42 58 43 58	44+  REGIATERS_SEQUENCE	 db 'AXBXCXDXSIDIBPSPDSESSSCS'
    475	      58 53 49 44 49 42	50+
    476	      53 50 44 53 45 53	53+
    477	      53 43 53
    478
    479	0305  01		     ActivateFrame	 db 1
    480
    481	0306			     EOP:
    482
    483						 end Start
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 10
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/10/25"
??FILENAME			  Text	 "regs	  "
??TIME				  Text	 "12:51:25"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 REGS
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ACTIVATEFRAME			  Byte	 DGROUP:0305
ACTIVATEKEYBOARD		  Near	 DGROUP:0232
ANTIATOI			  Near	 DGROUP:02C8
CENTER_OF_SCREEN_CLMN		  Number 000B
DRAWONELINE			  Near	 DGROUP:01D8
EOP				  Near	 DGROUP:0306
FIRST_REG_LETTER		  Byte	 DGROUP:02DB
FRAMEMAKER			  Near	 DGROUP:0181
FRAMEMASSIVE			  Byte	 DGROUP:02D2
FRAME_ACTIVATOR			  Number 0066
FRAME_COLOR			  Number 003C
FRAME_HIGHT			  Number 0014
FRAME_LENGHT			  Number 001E
HEX_SYMBOLS			  Byte	 DGROUP:02DD
INT08OFS			  Word	 DGROUP:026C
INT08SEG			  Word	 DGROUP:026E
INT08STATUSSCANNER		  Near	 DGROUP:024A
INT09OFS			  Word	 DGROUP:0246
INT09SEG			  Word	 DGROUP:0248
LENGHT_OF_FRAME_MASSIVE		  Number 000A
NOTACTIVATESYMB			  Near	 DGROUP:0228
NOTHINGTODRAW			  Near	 DGROUP:026B
NOTSPECIALSYMB			  Near	 DGROUP:0244
OUTPUTREGS			  Near	 DGROUP:0270
REGIATERS_SEQUENCE		  Byte	 DGROUP:02ED
SCREEN_HIGHT_IN_VISUAL		  Number 0019
SCREEN_LENGHT_IN_MEM		  Number 00A0
SECOND_REG_LETTER		  Byte	 DGROUP:02DC
START				  Near	 DGROUP:0100
STARTDRAWING			  Near	 DGROUP:01B3
STARTRESIDENTPROGRAMM		  Near	 DGROUP:011B
STOP_FRAME			  Number 0071
TAKEFRAMECOORDINATE		  Near	 DGROUP:01E0
VIDEO_MEM			  Number B800
WITHORNOTWITHFRAME		  Near	 DGROUP:0213
WRITEREGISTER			  Near	 DGROUP:028C
Turbo Assembler	 Version 4.1	    03/10/25 12:51:25	    Page 11
Symbol Table




Macro Name

POP_SAVED_REGS
PUSH_TO_SAVE_ALL_REGS

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0306 Word	  Public  CODE
